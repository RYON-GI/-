<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—”ë“œí•„ë“œ ê¸°ì§ˆ ìŠ¤ìºë„ˆ & íŒŒë° ê°€ì´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --primary: #4db8ff; --bg: #121212; --panel: #1e1e1e; --gold: #ffcc00; --purple: #a335ee; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-container { display: flex; gap: 5px; width: 100%; max-width: 1000px; margin-bottom: -1px; }
        .tab { padding: 10px 25px; background: #2a2a2a; border: 1px solid #333; border-bottom: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; color: #888; transition: 0.2s; }
        .tab.active { background: var(--panel); color: var(--primary); border-top: 3px solid var(--primary); z-index: 2; }
        
        .main-wrapper { display: grid; grid-template-columns: 1fr; gap: 20px; max-width: 1000px; width: 100%; background: var(--panel); padding: 20px; border-radius: 0 12px 12px 12px; border: 1px solid #333; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        
        /* ê³µí†µ ì˜ì—­ ì œì–´ */
        .content-area { display: none; flex-direction: column; gap: 20px; }
        .content-area.active { display: flex; }

        /* ì„œë¸Œ íƒ­ ìŠ¤íƒ€ì¼ (íŒŒë° ê°€ì´ë“œ ë‚´ë¶€) */
        .sub-tab-bar { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .sub-tab { padding: 8px 20px; background: #333; border-radius: 6px; cursor: pointer; font-size: 0.9em; border: 1px solid transparent; }
        .sub-tab.active { background: var(--primary); color: #000; font-weight: bold; }

        /* íŒŒë° ê°€ì´ë“œ ë ˆì´ì•„ì›ƒ */
        .farming-layout { display: grid; grid-template-columns: 1fr 380px; gap: 20px; }
        .weapon-selector { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; max-height: 800px; overflow-y: auto; }
        .weapon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-bottom: 20px; }
        .weapon-card { cursor: pointer; border: 2px solid transparent; border-radius: 8px; overflow: hidden; background: #2a2a2a; transition: 0.2s; position: relative; }
        .weapon-card.selected { border-color: var(--gold); box-shadow: 0 0 10px rgba(255,204,0,0.4); }
        .weapon-card img { width: 100%; height: 80px; object-fit: cover; display: block; }
        .weapon-card div { font-size: 0.7em; padding: 5px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .recommend-panel { background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 10px; padding: 15px; position: relative; }
        .place-card { background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #444; }
        .place-card.top { border-left-color: var(--gold); background: #2d2a20; }

        /* ì§€ì—­ë³„ ì˜µì…˜ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        .opt-btn { margin: 3px; padding: 6px 12px; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #ccc; cursor: pointer; font-size: 0.85em; transition: 0.2s; }
        .opt-btn.active { background: var(--primary); color: #000; border-color: var(--primary); font-weight: bold; }

        /* ìŠ¤ìºë„ˆ ë ˆì´ì•„ì›ƒ */
        .scanner-layout { display: none; grid-template-columns: 450px 1fr; gap: 20px; }
        .scanner-layout.active { display: grid; }
        canvas { border: 2px solid #444; border-radius: 10px; width: 100%; background: #000; }
        .opt-box { background: #252525; padding: 12px 18px; border-radius: 8px; border-left: 5px solid var(--primary); height: 35px; display: flex; align-items: center; margin-top: 5px; }
        .opt-name { font-size: 1.2em; font-weight: bold; color: #ffff00; }
        .match-count { font-size: 0.85em; font-weight: bold; padding: 2px 10px; border-radius: 10px; background: var(--gold); color: #000; }
        
        button.primary-btn { padding: 10px 30px; cursor: pointer; font-weight: bold; background: #007bff; color: white; border: none; border-radius: 8px; }
        .reset-btn { background: #444; color: #fff; padding: 5px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 0.8em; }
        .reset-btn:hover { background: #555; }
    </style>
</head>
<body>

<div class="tab-container">
    <div id="tab-guide" class="tab active" onclick="switchTab('guide')">ì‚¬ìš© ì„¤ëª…ì„œ</div>
    <div id="tab-farming" class="tab" onclick="switchTab('farming')">ì¶”ì²œ íŒŒë°ì§€</div>
    <div id="tab-warehouse" class="tab" onclick="switchTab('warehouse')">ê·€ì¤‘í’ˆ ì°½ê³ </div>
    <div id="tab-etching" class="tab" onclick="switchTab('etching')">ê¸°ì§ˆ ì‹ê°</div>
</div>

<div class="main-wrapper">
    <div id="area-guide" class="content-area active">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="color: var(--primary); margin-bottom: 5px;">Endfield ê¸°ì§ˆ ìŠ¤ìºë„ˆ ê°€ì´ë“œ</h1>
            <p style="color: #888;">ì •í™•í•œ ì¸ì‹ì„ ìœ„í•´ ì•„ë˜ ê°€ì´ë“œì— ë§ì¶° ê²Œì„ í™”ë©´ì„ ê³µìœ í•´ ì£¼ì„¸ìš”.</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid #444;">
                <div style="color: var(--gold); font-weight: bold; margin-bottom: 10px;"><span>1ï¸âƒ£</span> í™”ë©´ ê³µìœ  ì„¤ì •</div>
                <div style="font-size: 0.9em; color: #ccc; margin-bottom: 10px;">[í™”ë©´ ê³µìœ  ì‹œì‘] í´ë¦­ í›„ <b>'ì°½' íƒ­</b>ì—ì„œ <b>Endfield ê²Œì„ ì°½</b>ì„ ì„ íƒí•˜ì„¸ìš”. 'ì „ì²´ í™”ë©´'ë³´ë‹¤ ì¸ì‹ì´ ë” ì •í™•í•©ë‹ˆë‹¤.</div>
                <img src="1.jpg" style="width: 100%; border-radius: 8px; border: 1px solid #555;" onerror="this.src='https://via.placeholder.com/400x200?text=Step1+Image'">
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid #444;">
                <div style="color: var(--gold); font-weight: bold; margin-bottom: 10px;"><span>2ï¸âƒ£</span> ê·€ì¤‘í’ˆ ì°½ê³  / ì‹ê° ëª¨ë“œ</div>
                <div style="font-size: 0.9em; color: #ccc; margin-bottom: 10px;">ê°€ë°©ì˜ [ê·€ì¤‘í’ˆ ì°½ê³ ]ë‚˜ [ì‹ê°] í™”ë©´ì—ì„œ ê¸°ì§ˆì„ í´ë¦­í•˜ë©´ ìš°ì¸¡/í•˜ë‹¨ì˜ ì¶”ê°€ ì˜µì…˜ë“¤ì„ ìë™ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.</div>
                <img src="2.jpg" style="width: 100%; border-radius: 8px; border: 1px solid #555;" onerror="this.src='https://via.placeholder.com/400x200?text=Step2+Image'">
            </div>
        </div>

        <div style="background: rgba(77, 184, 255, 0.1); padding: 15px; border-radius: 12px; border: 1px solid var(--primary); margin-top: 10px;">
            <div style="color: var(--primary); font-weight: bold; margin-bottom: 5px;">ğŸ’¡ ì‹ ê·œ ê¸°ëŠ¥: ì§€ì—­ë³„ ì°¾ê¸°</div>
            <div style="font-size: 0.9em;">ì´ì œ [ì¶”ì²œ íŒŒë°ì§€] íƒ­ì—ì„œ <b>íŠ¹ì • ì§€ì—­ì„ ì„ íƒ</b>í•˜ê³  ì›í•˜ëŠ” ì˜µì…˜ì„ ì¡°í•©í•´ ë³´ì„¸ìš”. í•´ë‹¹ ì§€ì—­ì—ì„œ ì–´ë–¤ ë¬´ê¸°ë“¤ì„ ì¢…ê²°ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ ì´ë¯¸ì§€ë¡œ ë°”ë¡œ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤!</div>
        </div>

        <button class="primary-btn" onclick="switchTab('farming')" style="width: 100%; padding: 20px; font-size: 1.2em; background: var(--primary); color: #000; margin-top: 10px;">ì„¤ëª…ì„œë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì‹œì‘í•˜ê¸°!</button>
    </div>

    <div id="area-farming" class="content-area">
        <div class="sub-tab-bar">
            <div id="subtab-weapon" class="sub-tab active" onclick="switchSubTab('weapon')">ë¬´ê¸°ë³„ ì°¾ê¸°</div>
            <div id="subtab-place" class="sub-tab" onclick="switchSubTab('place')">ì§€ì—­ë³„ ì°¾ê¸°</div>
        </div>

        <div class="farming-layout">
            <div class="weapon-selector">
                <div id="subarea-weapon">
                    <h3 style="color:var(--gold); margin-top:0;">6ì„± ë¬´ê¸°</h3>
                    <div id="grid-6star" class="weapon-grid"></div>
                    <h3 style="color:var(--purple)">5ì„± ë¬´ê¸°</h3>
                    <div id="grid-5star" class="weapon-grid"></div>
                </div>

                <div id="subarea-place" style="display:none;">
                    <h3 style="color:var(--primary); margin-top:0;">ì§€ì—­ ì„ íƒ</h3>
                    <select id="place-select" onchange="updatePlaceOptions()" style="width:100%; padding:12px; background:#333; color:white; border:1px solid #555; border-radius:8px; margin-bottom:20px;">
                        <option value="">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ê±°ì  ì§€ì—­">ê±°ì  ì§€ì—­</option>
                        <option value="ì˜¤ë¦¬ì§€ëŠ„ ì—°êµ¬ êµ¬ì—­">ì˜¤ë¦¬ì§€ëŠ„ ì—°êµ¬ êµ¬ì—­</option>
                        <option value="ê´‘ë§¥ êµ¬ì—­">ê´‘ë§¥ êµ¬ì—­</option>
                        <option value="ì—ë„ˆì§€ ê³µê¸‰ ê³ ì§€">ì—ë„ˆì§€ ê³µê¸‰ ê³ ì§€</option>
                        <option value="ë¬´ë¦‰ì„±">ë¬´ë¦‰ì„±</option>
                    </select>
                    
                    <div id="place-option-ui">
                        <div style="color:var(--gold); font-weight:bold; margin-bottom:10px;">ê¸°ì´ˆ ì†ì„± (ìµœëŒ€ 3ê°œ)</div>
                        <div id="place-base-btns" style="margin-bottom:20px;"></div>
                        <div style="color:var(--purple); font-weight:bold; margin-bottom:10px;">ì¶”ê°€/ìŠ¤í‚¬ ì†ì„± (ìµœëŒ€ 1ê°œ)</div>
                        <div id="place-skill-btns"></div>
                    </div>
                </div>
            </div>

            <div class="recommend-panel">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
                    <h3 style="margin:0;">ğŸ’¡ ê²°ê³¼ ë¦¬í¬íŠ¸</h3>
                    <button class="reset-btn" onclick="resetFarming()">ì´ˆê¸°í™”</button>
                </div>
                <div id="farming-results">ë¬´ê¸°ë‚˜ ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <div id="area-scanner" class="scanner-layout">
        <div style="grid-column: span 2; display: flex; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;">
            <button id="start-btn" class="primary-btn" disabled>ë¡œë”© ì¤‘...</button>
            <div style="font-size: 0.8em; color: #888;">* í™”ë©´ ê³µìœ  ì‹œ 'ì°½' ëª¨ë“œ ê¶Œì¥</div>
        </div>
        <div>
            <div style="color:var(--primary); font-weight: bold; margin-bottom:5px;">ì‹¤ì‹œê°„ ì¸ì‹</div>
            <canvas id="view-canvas"></canvas>
            <div id="opt-1" class="opt-box"><div class="opt-name">-</div></div>
            <div id="opt-2" class="opt-box"><div class="opt-name">-</div></div>
            <div id="opt-3" class="opt-box"><div class="opt-name">-</div></div>
        </div>
        <div class="section-box" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:10px;">
            <div style="color:var(--gold); font-weight:bold; border-bottom:1px solid #444; margin-bottom:10px;">ë§¤ì¹­ ë¬´ê¸° ë¦¬ìŠ¤íŠ¸</div>
            <div id="scan-match-list"></div>
        </div>
    </div>
</div>

<script>
// --- ë°ì´í„° ---
const PLACES = [
    { name: "ê±°ì  ì§€ì—­", opts: ["ë¯¼ì²©","í˜","ì˜ì§€","ì§€ëŠ¥","ì£¼ìš”ëŠ¥ë ¥ì¹˜","ê³µê²©ë ¥","ì—´ê¸°í”¼í•´","ì „ê¸°í”¼í•´","ëƒ‰ê¸°í”¼í•´","ìì—°í”¼í•´","ì•„ì¸ ê°•ë„","ê¶ê·¹ê¸°íšë“íš¨ìœ¨","ì•„ì¸ í”¼í•´","ê°•ê³µ","ì–µì œ","ì¶”ê²©","ë¶„ì‡„","ê¸°ì˜ˆ","ë°©ì¶œ","íë¦„","íš¨ìœ¨"] },
    { name: "ì˜¤ë¦¬ì§€ëŠ„ ì—°êµ¬ êµ¬ì—­", opts: ["ë¯¼ì²©","í˜","ì˜ì§€","ì§€ëŠ¥","ì£¼ìš”ëŠ¥ë ¥ì¹˜","ê³µê²©ë ¥","ë¬¼ë¦¬í”¼í•´","ì „ê¸°í”¼í•´","ëƒ‰ê¸°í”¼í•´","ìì—°í”¼í•´","ì¹˜ëª…íƒ€í™•ë¥ ","ê¶ê·¹ê¸°íšë“íš¨ìœ¨","ì•„ì¸ í”¼í•´","ì–µì œ","ì¶”ê²©","ì‚¬ê¸°","ê¸°ì˜ˆ","ê³ í†µ","ì˜ë£Œ","ê³¨ì ˆ","íš¨ìœ¨"] },
    { name: "ê´‘ë§¥ êµ¬ì—­", opts: ["ë¯¼ì²©","í˜","ì˜ì§€","ì§€ëŠ¥","ì£¼ìš”ëŠ¥ë ¥ì¹˜","ìƒëª…ë ¥","ë¬¼ë¦¬í”¼í•´","ì—´ê¸°í”¼í•´","ëƒ‰ê¸°í”¼í•´","ìì—°í”¼í•´","ì¹˜ëª…íƒ€í™•ë¥ ","ì•„ì¸ ê°•ë„","ì¹˜ìœ íš¨ìœ¨","ê°•ê³µ","ì–µì œ","ê¸°ì˜ˆ","ì”í˜¹","ê³ í†µ","ë°©ì¶œ","ì–´ë‘ ","íš¨ìœ¨"] },
    { name: "ì—ë„ˆì§€ ê³µê¸‰ ê³ ì§€", opts: ["ë¯¼ì²©","í˜","ì˜ì§€","ì§€ëŠ¥","ì£¼ìš”ëŠ¥ë ¥ì¹˜","ê³µê²©ë ¥","ìƒëª…ë ¥","ë¬¼ë¦¬í”¼í•´","ì—´ê¸°í”¼í•´","ìì—°í”¼í•´","ì¹˜ëª…íƒ€í™•ë¥ ","ì•„ì¸ ê°•ë„","ì¹˜ìœ íš¨ìœ¨","ì¶”ê²©","ë¶„ì‡„","ì‚¬ê¸°","ì”í˜¹","ê³ í†µ","ì˜ë£Œ","ê³¨ì ˆ","íë¦„"] },
    { name: "ë¬´ë¦‰ì„±", opts: ["ë¯¼ì²©","í˜","ì˜ì§€","ì§€ëŠ¥","ì£¼ìš”ëŠ¥ë ¥ì¹˜","ê³µê²©ë ¥","ìƒëª…ë ¥","ì „ê¸°í”¼í•´","ëƒ‰ê¸°í”¼í•´","ì¹˜ëª…íƒ€í™•ë¥ ","ê¶ê·¹ê¸°íšë“íš¨ìœ¨","ì•„ì¸ í”¼í•´","ì¹˜ìœ íš¨ìœ¨","ê°•ê³µ","ë¶„ì‡„","ì”í˜¹","ì˜ë£Œ","ê³¨ì ˆ","ë°©ì¶œ","ì–´ë‘ ","íë¦„"] }
];

const WEAPONS_6 = [
    { name: "ê³¼ê±°ì˜ ì¼í’ˆ", opts: ["ì˜ì§€", "ìƒëª…ë ¥", "íš¨ìœ¨"] },
    { name: "ê¸°ì‚¬ë„ ì •ì‹ ", opts: ["ì˜ì§€", "ìƒëª…ë ¥", "ì˜ë£Œ"] },
    { name: "ëì—†ëŠ” ë°©ë‘", opts: ["ì˜ì§€", "ê³µê²©ë ¥", "íë¦„"] },
    { name: "ë§ê°", opts: ["ì§€ëŠ¥", "ì•„ì¸ í”¼í•´", "ì–´ë‘ "] },
    { name: "ëª¨ë²”", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ê³µê²©ë ¥", "ì–µì œ"] },
    { name: "ë°”ë‹¤ì™€ ë³„ì˜ ê¿ˆ", opts: ["ì§€ëŠ¥", "ì¹˜ìœ íš¨ìœ¨", "ê³ í†µ"] },
    { name: "ë°±ì•¼ì˜ ë³„", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ì•„ì¸ ê°•ë„", "ê³ í†µ"] },
    { name: "ë¶€ìš”", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ì¹˜ëª…íƒ€í™•ë¥ ", "ì–´ë‘ "] },
    { name: "ë¶„ì‡„ì˜ êµ°ì£¼", opts: ["í˜", "ì¹˜ëª…íƒ€í™•ë¥ ", "ë¶„ì‡„"] },
    { name: "ì‚¬ëª…ì˜ ê¸¸", opts: ["ì˜ì§€", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ì¶”ê²©"] },
    { name: "ì‚°ì˜ ì§€ë°°ì", opts: ["ë¯¼ì²©", "ë¬¼ë¦¬í”¼í•´", "íš¨ìœ¨"] },
    { name: "ìê¸°", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ì¹˜ëª…íƒ€í™•ë¥ ", "ê³ í†µ"] },
    { name: "ì•”í‘ì˜ íšƒë¶ˆ", opts: ["ì§€ëŠ¥", "ì—´ê¸°í”¼í•´", "ê³ í†µ"] },
    { name: "ì˜ˆìˆ ì˜ í­êµ°", opts: ["ì§€ëŠ¥", "ì¹˜ëª…íƒ€í™•ë¥ ", "ê³¨ì ˆ"] },
    { name: "ìš©ì‚¬", opts: ["ë¯¼ì²©", "ë¬¼ë¦¬í”¼í•´", "ê¸°ì˜ˆ"] },
    { name: "ìš©ì¡°ì˜ ë¶ˆê½ƒ", opts: ["ì§€ëŠ¥", "ê³µê²©ë ¥", "ì–´ë‘ "] },
    { name: "ìœ„ëŒ€í•œ ì´ë¦„", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ë¬¼ë¦¬í”¼í•´", "ì”í˜¹"] },
    { name: "ì‘í’ˆ: ì¹¨ì‹ í”ì ", opts: ["ì˜ì§€", "ìì—°í”¼í•´", "ì–µì œ"] },
    { name: "ì¥ëŒ€í•œ ì—¼ì›", opts: ["ë¯¼ì²©", "ê³µê²©ë ¥", "ê³ í†µ"] },
    { name: "ì²œë‘¥ì˜ í”ì ", opts: ["í˜", "ìƒëª…ë ¥", "ì˜ë£Œ"] },
    { name: "í´ë˜ë‹ˆë²Œ", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ì•„ì¸ ê°•ë„", "ê³ í†µ"] },
    { name: "í…Œë¥´ë°‹ ì»¤í„°", opts: ["ì˜ì§€", "ê³µê²©ë ¥", "íë¦„"] },
    { name: "í­ë°œ ìœ ë‹›", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ì•„ì¸ ê°•ë„", "ë°©ì¶œ"] },
    { name: "í•­ë¡œì˜ ê°œì²™ì", opts: ["ì§€ëŠ¥", "ëƒ‰ê¸°í”¼í•´", "ê³ í†µ"] },
    { name: "í—¤ë¼íœê±°", opts: ["í˜", "ê³µê²©ë ¥", "ë°©ì¶œ"] },
    { name: "J.E.T.", opts: ["ì£¼ìš”ëŠ¥ë ¥ì¹˜", "ê³µê²©ë ¥", "ì–µì œ"] }
];

const WEAPONS_5 = [
    { name: "ê°•ì² ì˜ ì—¬ìš´", opts: ["ë¯¼ì²©", "ë¬¼ë¦¬í”¼í•´", "ê¸°ì˜ˆ"] },
    { name: "ê²€ì€ ì¶”ì ì", opts: ["í˜", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ë°©ì¶œ"] },
    { name: "ê³ ëŒ€ì˜ ê°•ì¤„ê¸°", opts: ["í˜", "ì•„ì¸ ê°•ë„", "ì”í˜¹"] },
    { name: "ë¦°ìˆ˜ë¥¼ ì°¾ì•„ì„œ 3.0", opts: ["í˜", "ëƒ‰ê¸°í”¼í•´", "ì–µì œ"] },
    { name: "ë§ìì˜ ë…¸ë˜", opts: ["ì§€ëŠ¥", "ê³µê²©ë ¥", "ì–´ë‘ "] },
    { name: "ë¬´ê°€ë‚´í•˜", opts: ["ì˜ì§€", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ì‚¬ê¸°"] },
    { name: "ë¶ˆì‚¬ì˜ ì„±ì£¼", opts: ["ì§€ëŠ¥", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ì‚¬ê¸°"] },
    { name: "ì„ êµì˜ ììœ ", opts: ["ì˜ì§€", "ì¹˜ìœ íš¨ìœ¨", "ì˜ë£Œ"] },
    { name: "ìˆ­ë°°ì˜ ì‹œì„ ", opts: ["ë¯¼ì²©", "ë¬¼ë¦¬í”¼í•´", "ì–´ë‘ "] },
    { name: "ì‹­ì´ë¬¸", opts: ["ë¯¼ì²©", "ê³µê²©ë ¥", "ê³ í†µ"] },
    { name: "ì´ì„±ì ì¸ ì‘ë³„", opts: ["í˜", "ì—´ê¸°í”¼í•´", "ì¶”ê²©"] },
    { name: "ì‘í’ˆ: ì¤‘ìƒ", opts: ["ë¯¼ì²©", "ì•„ì¸ ê°•ë„", "ê³ í†µ"] },
    { name: "ì¤‘ì‹¬ë ¥", opts: ["ì˜ì§€", "ì „ê¸°í”¼í•´", "ì–µì œ"] },
    { name: "ìµœí›„ì˜ ë©”ì•„ë¦¬", opts: ["í˜", "ìƒëª…ë ¥", "ì˜ë£Œ"] },
    { name: "í‚¤ë©”ë¼ì˜ ì •ì˜", opts: ["í˜", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ì”í˜¹"] },
    { name: "í™©ë¬´ì§€ì˜ ë°©ë‘ì", opts: ["ì§€ëŠ¥", "ì „ê¸°í”¼í•´", "ê³ í†µ"] },
    { name: "O.B.J. ë²¨ë¡œì‹œíˆ¬ìŠ¤", opts: ["ë¯¼ì²©", "ê¶ê·¹ê¸°íšë“íš¨ìœ¨", "ë°©ì¶œ"] },
    { name: "O.B.J. ìŠ¤íŒŒì´í¬", opts: ["ì˜ì§€", "ë¬¼ë¦¬í”¼í•´", "ê³ í†µ"] },
    { name: "O.B.J. ì•„ì¸  ì•„ì´ë´í‹°í‹°", opts: ["ì§€ëŠ¥", "ì•„ì¸ ê°•ë„", "ì¶”ê²©"] },
    { name: "O.B.J. ì—£ì§€ ì˜¤ë¸Œ ë¼ì´íŠ¸", opts: ["ë¯¼ì²©", "ê³µê²©ë ¥", "íë¦„"] },
    { name: "O.B.J. í—¤ë¹„ ë²„ë“ ", opts: ["í˜", "ìƒëª…ë ¥", "íš¨ìœ¨"] }
];

// --- ë³€ìˆ˜ ---
let selectedWeapons = new Set();
let currentSubTab = 'weapon';
let selectedPlaceOpts = { base: new Set(), skill: new Set() };
const baseStats = ["ë¯¼ì²©", "í˜", "ì˜ì§€", "ì§€ëŠ¥", "ì£¼ìš”ëŠ¥ë ¥ì¹˜"];

// --- ì´ˆê¸°í™” ---
window.onload = () => {
    initFarmingUI();
    initOCR();
};

function switchTab(id) {
    document.querySelectorAll('.tab, .content-area, .scanner-layout').forEach(el => el.classList.remove('active'));
    document.getElementById(`tab-${id}`).classList.add('active');
    
    if(id === 'guide') document.getElementById('area-guide').classList.add('active');
    else if(id === 'farming') document.getElementById('area-farming').classList.add('active');
    else {
        document.getElementById('area-scanner').classList.add('active');
        // ì—¬ê¸°ì„œ ì°½ê³ /ì‹ê° ëª¨ë“œ ì„¤ì • ê°€ëŠ¥ (ROI ë³€ê²½ ë“±)
    }
}

function switchSubTab(sub) {
    currentSubTab = sub;
    document.getElementById('subtab-weapon').classList.toggle('active', sub === 'weapon');
    document.getElementById('subtab-place').classList.toggle('active', sub === 'place');
    document.getElementById('subarea-weapon').style.display = sub === 'weapon' ? 'block' : 'none';
    document.getElementById('subarea-place').style.display = sub === 'place' ? 'block' : 'none';
    resetFarming();
}

function resetFarming() {
    selectedWeapons.clear();
    selectedPlaceOpts.base.clear();
    selectedPlaceOpts.skill.clear();
    document.querySelectorAll('.weapon-card').forEach(c => c.classList.remove('selected'));
    document.querySelectorAll('.opt-btn').forEach(b => {
        b.classList.remove('active');
        b.style.background = "#2a2a2a";
        b.style.color = "#ccc";
    });
    document.getElementById('place-select').value = "";
    document.getElementById('farming-results').innerHTML = "ë¬´ê¸°ë‚˜ ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.";
}

// --- íŒŒë° ê°€ì´ë“œ: ë¬´ê¸°ë³„ ---
function initFarmingUI() {
    const g6 = document.getElementById('grid-6star'), g5 = document.getElementById('grid-5star');
    const makeCard = (w, path) => {
        const div = document.createElement('div');
        div.className = 'weapon-card';
        const safeName = w.name.replace(/:/g, "");
        div.onclick = () => {
            if(selectedWeapons.has(w)) { selectedWeapons.delete(w); div.classList.remove('selected'); }
            else { selectedWeapons.add(w); div.classList.add('selected'); }
            updateWeaponFarmingResults();
        };
        div.innerHTML = `<img src="${path}/${safeName}.png" onerror="this.src='https://via.placeholder.com/80?text=No+Img'"><div>${w.name}</div>`;
        return div;
    };
    WEAPONS_6.forEach(w => g6.appendChild(makeCard(w, '6ì„± ë¬´ê¸°')));
    WEAPONS_5.forEach(w => g5.appendChild(makeCard(w, '5ì„± ë¬´ê¸°')));
}

function updateWeaponFarmingResults() {
    const resDiv = document.getElementById('farming-results');
    if (selectedWeapons.size === 0) { resDiv.innerHTML = "ë¬´ê¸°ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”."; return; }

    const optionCounts = {};
    selectedWeapons.forEach(w => w.opts.forEach(o => optionCounts[o] = (optionCounts[o] || 0) + 1));

    const results = PLACES.map(place => {
        const placeOpts = new Set(place.opts);
        const matches = [...selectedWeapons].filter(w => w.opts.every(o => placeOpts.has(o)));
        
        // ì¶”ì²œ ì„¸íŒ… (ê²¹ì¹¨ ìš°ì„  ë¡œì§)
        const recBases = place.opts.filter(o => baseStats.includes(o) && optionCounts[o]).sort((a,b) => optionCounts[b] - optionCounts[a]).slice(0, 3);
        const recSkills = place.opts.filter(o => !baseStats.includes(o) && optionCounts[o]).sort((a,b) => {
            if(optionCounts[b] !== optionCounts[a]) return optionCounts[b] - optionCounts[a];
            return 1; // ê°¯ìˆ˜ ê°™ìœ¼ë©´ ìŠ¤í‚¬ ì†ì„±(ì›ë˜ ë¦¬ìŠ¤íŠ¸ ë’¤ìª½) ìš°ì„ 
        }).slice(0, 1);

        return { name: place.name, matches, rec: [...recBases, ...recSkills] };
    }).sort((a, b) => b.matches.length - a.matches.length);

    let html = "";
    results.forEach((r, i) => {
        html += `<div class="place-card ${i===0 && r.matches.length > 0 ? 'top' : ''}">
            <div style="display:flex; justify-content:space-between; font-weight:bold;">
                <span>${i===0 && r.matches.length > 0 ? 'ğŸ‘‘ ' : ''}${r.name}</span>
                <span style="color:var(--gold)">${r.matches.length}ê°œ ì¢…ê²° ê°€ëŠ¥</span>
            </div>
            <div style="font-size:0.85em; margin-top:8px;">
                <b>ì¶”ì²œ ì„¸íŒ…:</b> ${r.rec.join(', ') || 'ì—†ìŒ'}<br>
                <span style="color:#888;">ëŒ€ìƒ: ${r.matches.map(m => m.name).join(', ') || 'ì—†ìŒ'}</span>
            </div>
        </div>`;
    });
    resDiv.innerHTML = html;
}

// --- íŒŒë° ê°€ì´ë“œ: ì§€ì—­ë³„ ---
function updatePlaceOptions() {
    const placeName = document.getElementById('place-select').value;
    const baseArea = document.getElementById('place-base-btns'), skillArea = document.getElementById('place-skill-btns');
    selectedPlaceOpts.base.clear(); selectedPlaceOpts.skill.clear();
    
    if(!placeName) { baseArea.innerHTML = ""; skillArea.innerHTML = ""; return; }
    
    const place = PLACES.find(p => p.name === placeName);
    const createBtn = (opt, isBase) => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn';
        btn.textContent = opt;
        btn.onclick = () => {
            const set = isBase ? selectedPlaceOpts.base : selectedPlaceOpts.skill;
            const limit = isBase ? 3 : 1;
            if(set.has(opt)) set.delete(opt);
            else if(set.size < limit) set.add(opt);
            else return;
            
            btn.classList.toggle('active', set.has(opt));
            updatePlaceFarmingResults();
        };
        return btn;
    };

    baseArea.innerHTML = ""; skillArea.innerHTML = "";
    place.opts.forEach(o => {
        if(baseStats.includes(o)) baseArea.appendChild(createBtn(o, true));
        else skillArea.appendChild(createBtn(o, false));
    });
}

function updatePlaceFarmingResults() {
    const resDiv = document.getElementById('farming-results');
    const selectedAll = [...selectedPlaceOpts.base, ...selectedPlaceOpts.skill];
    if(selectedAll.length === 0) { resDiv.innerHTML = "ì˜µì…˜ì„ ì„ íƒí•´ ì£¼ì„¸ìš”."; return; }

    const all = [...WEAPONS_6, ...WEAPONS_5];
    const matches = all.map(w => ({ ...w, hit: w.opts.filter(o => selectedAll.includes(o)).length }))
                       .filter(w => w.hit > 0).sort((a,b) => b.hit - a.hit);

    let html = `<div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap:10px;">`;
    matches.forEach(w => {
        const is6 = WEAPONS_6.some(r => r.name === w.name);
        const path = is6 ? '6ì„± ë¬´ê¸°' : '5ì„± ë¬´ê¸°';
        const safeName = w.name.replace(/:/g, "");
        html += `<div style="background:#2a2a2a; border:1px solid ${w.hit===3?'var(--gold)':'#444'}; border-radius:8px; padding:5px; text-align:center; position:relative;">
            <div style="position:absolute; top:2px; right:2px; background:var(--gold); color:#000; font-size:0.7em; padding:1px 4px; border-radius:4px; font-weight:bold;">${w.hit}/3</div>
            <img src="${path}/${safeName}.png" style="width:100%; height:70px; object-fit:cover; border-radius:4px;" onerror="this.src='https://via.placeholder.com/70?text=No+Img'">
            <div style="font-size:0.7em; margin-top:5px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${w.name}</div>
        </div>`;
    });
    resDiv.innerHTML = html + "</div>";
}

// --- OCR ê´€ë ¨ (ê¸°ì¡´ ë¡œì§ ìœ ì§€) ---
async function initOCR() {
    try {
        const worker = await Tesseract.createWorker('kor');
        document.getElementById('start-btn').disabled = false;
        document.getElementById('start-btn').textContent = "í™”ë©´ ê³µìœ  ì‹œì‘";
        // ì¸ì‹ ë¡œì§ì€ ì´ì „ ë‹µë³€ì˜ recognizeLoopì™€ ë™ì¼í•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥
    } catch(e) { console.error("OCR Load Error"); }
}
</script>

</body>
</html>
